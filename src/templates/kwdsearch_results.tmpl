#from DAS.web.utils import quote

#set msg = $quote($msg)
#assert (isinstance($msg, str) or isinstance($msg, unicode))

#if $err:
        <div style="color: #fff; background-color: #992222; padding: 5px; margin-top: 20px">
            Due to complexity of your query or high load on the server,
            we are able to show only a subset of all suggestions (which
            may be useless).</div>
#end if


<div id="filter-by-entity">
#if $hi_score_result_types

    <div class="select-result-type">
            <span class="tooltip">Filter by query result:
                <span class="classic">You may filter suggestions by the entity they return</span></span>
                    &nbsp;<span class="rt-filters">
                        #for index, rt in enumerate($hi_score_result_types):
#if index != 0 then ', &nbsp;' else '&nbsp;'
<a onclick="filterByResultType('$rt', this)" href="#" class="rt-$rt">$rt</a>#slurp
                        #end for
                    </span>
        </div>

#end if

</div>


#if not $is_ajax
    <link rel="stylesheet" href="/das/css/?f=jquery-ui.css&f=kwsearch.css" />
    <script src="/das/js/?f=jquery.min.js" type="text/javascript"></script>
    <script type="text/javascript">
        jQuery.noConflict();
    </script>
    <script src="/das/js/?f=jquery-ui.js" type="text/javascript"></script>

     <!--
    <b>Your input  does not follow DAS query language.<br />
       Consider these query propositions...</b><br /> -->


    <b>Did you mean any of the queries below?</b><br />
    <!-- (can't interpret your query)<br /> -->
#end if

<div id="kws-results-container">


    #if not $is_ajax
    <div id="kws-entry-points">

        <h4>Color-coding:</h4>
        <span class="q-res-type">entity to be retrieved</span> <br />
        <span class="q-field-name">filter (an input to service(s))</span> <br />
        <span class="q-post-filter-field-name">expensive filter (applied only after retrieving all data)</span>
        <br />

        <!--
        <h4>How your query was interpreted ...</h4>
        <p>You wonder why do you get such propositions? Here is how we interpret your query...<br />
            Specify below what exactly you meant, and improve the results...</p>

        [entry_points]

        -->

    </div>
    #end if


    <div id="kws-results-listing"> <!-- main div -->




        $msg

        <!-- list proposed queries along with their scores -->
        #for $item in $proposed_queries:
            #set query_escaped = $quote($item.result)
            #set nl_query_escaped = $quote($item.query_in_words)


            <div class="kws-result result-with-entity-${item.entity}">

               <div class="score-bar" style="width: ${item.bar.max_w}px;">
                         <div class="score-bar-inner score-bar-inner-${item.bar.style}" style="width: ${item.bar.w}px;"></div>
                         <span class="score-num">
                                #echo "%.2f" % $item.bar.score
                         </span>
               </div>

               <a class="kws-link" href="$item.link" target="_blank"
                                    title="Explanation: &lt;br/&gt; $nl_query_escaped">$item.query_html</a>
                <a class="debug" title="$item.trace">debug</a>
            </div>

        #end for

    </div> <!-- end of main div -->

</div>

<div style="color: #666">
    $initial_err_message
</div>



<script type="text/javascript">

    //
    // result type selector
    //

    var RTYPE_ANY = "any";

    function hide(selector){
        //jQuery(selector).hide().;
    }
    function filterByResultType(rt, target){
        if (rt == RTYPE_ANY) {
            jQuery('.kws-result').show(300);
        } else {
            jQuery('.kws-result').hide();
            jQuery('.result-with-entity-'+rt).show(300);
        }

        jQuery('.rt-filters a').removeClass('rtype-selected');
        //console.log(target, jQuery(target));
        jQuery(target).addClass('rtype-selected')
    }

    // by default select the "any"
    jQuery('.rt-'+RTYPE_ANY).addClass('rtype-selected');

    function showAllRT(){
    }


    // limit the number of results shown

    function showAllResults(){
        jQuery('.kws-result').show(300);
        jQuery('#results-only-top-k').html('');
    }


    function hideLowResults(){
        // hide all results lower than 10
        var limit = 10;
        var nimportant = 4;

        count = jQuery('.kws-result').length;

        if (count > limit) {
            jQuery('.kws-result:gt('+ (limit-1) +')').hide();
            var cont = jQuery('<div id="results-only-top-k">Showing only top ' + limit + ' suggestions.&nbsp;</div>');
            var showBtn = jQuery('<a href="javascript:;">see all</a>');
            showBtn.click(showAllResults);
            cont.append(showBtn);

            jQuery('div#kws-results-listing').append(cont);
        }

        //if (count > nimportant) {
        //    jQuery('.kws-result:gt('+ (nimportant-1) +')').css('opacity', 0.7);
        //}
    }



    jQuery(function() {
        // do not hide debug tooltip (TODO: it should be on click actually)
        jQuery(".debug").each(function(){
            jQuery(this).tooltip({
                content: jQuery(this).attr('title'),
                track: true,
                //close: true,
                hide: { effect: "fade", duration: 2000 }
                //function( event, ui ) { jQuery(this).tooltip('open'); },
            });
        });
        jQuery(".kws-link").each(function(){
            jQuery(this).tooltip({
                content: jQuery(this).attr('title')
            });
        });

        hideLowResults();

    });
</script>


<!-- end of kwdsearch_results.tmpl -->

