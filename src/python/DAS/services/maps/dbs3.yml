# DBS3 API mapping to DAS
system : dbs3
format : JSON
---
urn: acquisitioneras
url : "http://localhost:8585/DBS/acquisitioneras/"
expire : 3600
params : {}
daskeys : [
        {"key": "era", "map":"era", "pattern":""},
]
---
# Flow
# input: primary_ds
# converted into: primary_ds_name <== this is what we look-up, it is daskey
# need to convert daskey into input parameter (done by das2api) 
# primary_ds_name ==> primary_ds_name
# what is missing is when das2api query api2das-mapping and this mapping doesn't exist
#
urn: primarydatasets
url : "http://localhost:8585/DBS/primarydatasets/"
expire : 3600
params : {
        "primary_ds_name":"*",
}
daskeys : [
        {"key": "primary_ds", "map":"primary_ds.name", "pattern":""},
]
api2das : [
        {"das_key":"primary_ds.name", "api_param": "primary_ds_name", "pattern":""},
]
---
urn: datasets
url : "http://localhost:8585/DBS/datasets/"
expire : 3600
params : {
        "dataset":"*",
#        "datasetparent":"*",
#        "app_name":"*",
#        "release_version":"*",
#        "hash":"*",
#        "output_module_lavel":"*"
}
daskeys : [
        {"key": "dataset", "map":"dataset.name", "pattern":""},
        {"key": "type", "map":"datasettype", "pattern":""},
        {"key": "group", "map":"physicsgroup", "pattern":""},
        {"key": "tag", "map":"globaltag", "pattern":""},
        {"key": "c_section", "map":"xtcrosssection", "pattern":""},
]
api2das : [
        {"das_key":"dataset.name", "api_param": "dataset", "pattern":""},
]
---
urn: datasetparents
url : "http://localhost:8585/DBS/datasetparents/"
expire : 3600
params : {
        "dataset":"required",
}
daskeys : [
        {"key": "dataset", "map":"dataset.name", "pattern":""},
]
api2das : [
        {"das_key":"dataset.name", "api_param": "dataset", "pattern":""},
]
---
urn: blocks
url : "http://localhost:8585/DBS/blocks/"
expire : 3600
params : {
        'dataset':'*',
        'block_name':'*',
#        'site_name':'*',
}
daskeys : [
        {"key": "block", "map":"block.name", "pattern":""},
]
api2das : [
        {"das_key":"dataset.name", "api_param": "dataset", "pattern":""},
        {"das_key":"block.name", "api_param": "block_name", "pattern":""},
]
---
urn: files
url : "http://localhost:8585/DBS/files/"
expire : 3600
params : {
        'dataset':'required',
}
daskeys : [
        {"key": "file", "map":"file.name", "pattern":""},
        {"key": "dataset", "map":"file.dataset.name", "pattern":""},
]
api2das : [
        {"das_key":"file.dataset.name", "api_param":"dataset", "pattern":""},
        {"das_key":"file.block.name", "api_param":"block_name", "pattern":""}
]
---
urn: files2
url : "http://localhost:8585/DBS/files/"
expire : 3600
params : {
        'block_name':'required',
}
daskeys : [
        {"key": "file", "map":"file.name", "pattern":""},
        {"key": "block", "map":"file.block.name", "pattern":""},
]
api2das : [
        {"das_key":"file.dataset", "api_param":"dataset", "pattern":""},
        {"das_key":"file.block.name", "api_param":"block_name", "pattern":""}
]
---
urn: fileparents
url : "http://localhost:8585/DBS/fileparents/"
expire : 3600
params : {
        'logical_file_name':'required',
}
daskeys : [
        {"key": "file", "map":"file.name", "pattern":""},
]
api2das : [
        {"das_key":"file.name", "api_param":"logical_file_name", "pattern":""},
]
---
urn: filelumis
url : "http://localhost:8585/DBS/filelumis/"
expire : 3600
params : {
        'logical_file_name':'required',
}
daskeys : [
        {"key": "file", "map":"file.name", "pattern":""},
]
api2das : [
        {"das_key":"file.name", "api_param":"logical_file_name", "pattern":""},
]
---
notations : [
        {"notation": "primary_ds_name", "map": "name", "api": "primarydatasets"},
        {"notation": "primary_ds_name", "map": "primary_ds.name", "api": ""},
        {"notation": "dataset", "map": "name", "api": "datasets"},
        {"notation": "dataset", "map": "dataset.name", "api": ""},
        {"notation": "block_name", "map": "name", "api": "blocks"},
        {"notation": "block_name", "map": "block.name", "api": ""},
        {"notation": "block_size", "map": "size", "api": "blocks"},
        {"notation": "block_size", "map": "block.size", "api": ""},
        {"notation": "logical_file_name", "map": "name", "api": "files"},
        {"notation": "logical_file_name", "map": "name", "api": "files2"},
        {"notation": "logical_file_name", "map": "name", "api": "fileparents"},
        {"notation": "logical_file_name", "map": "name", "api": "filelumis"},
        {"notation": "file.logical_file_name", "map": "file.name", "api": ""},
        {"notation": "file_type", "map": "type", "api": "files"},
        {"notation": "file_type", "map": "type", "api": "files2"},
        {"notation": "file.file_type", "map": "file.type", "api": ""},
        {"notation": "file.block_name", "map": "file.block.name", "api": ""},
        {"notation": "file_size", "map": "size", "api": "files"},
        {"notation": "file_size", "map": "size", "api": "files2"},
        {"notation": "file.file_size", "map": "file.size", "api": ""},
        {"notation": "event_count", "map": "nevents", "api": "files"},
        {"notation": "event_count", "map": "nevents", "api": "files2"},
        {"notation": "file.event_count", "map": "file.nevents", "api": ""},
        {"notation": "run_num", "map": "run", "api": ""},
        {"notation": "lumi_section_num", "map": "lumi", "api": ""},
]
