#!/bin/sh

# usage: das_map

# setup environment
#. `dirname $0`/setup.sh

if  [ `hostname -d` == "cern.ch" ]
    dir=/data/projects/das/config/maps
else
    dir=$DAS_ROOT/src/python/DAS/services/maps
fi
cmd=$DAS_ROOT/src/python/DAS/tools/das_mapping_db.py

# run actual script
echo "Clean DAS Mapping DB"
$cmd --clean

echo "Add API maps"
for amap in `ls $dir/*.yml`
do
    service=`echo $amap | awk '{z=split($0,a,"/"); split(a[z],b,"."); print b[1]}'`
    echo "Read API maps from $amap"
    $cmd --uri-map=$amap
    echo "Read notation map from $amap"
    $cmd --notation-map=$amap
    echo "Read presentation map from $amap"
    $cmd --presentation-map=$amap
done
