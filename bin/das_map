#!/usr/bin/env bash

# setup environment
#. `dirname $0`/setup.sh

dir=$DAS_ROOT/src/python/DAS/services/maps
cmd=$DAS_ROOT/src/python/DAS/tools/das_mapping_db.py
chmod a+x $cmd

# run actual script
echo "Clean DAS Mapping DB"
$cmd --clean

echo "Add API maps"
for amap in `ls $dir/*.yml`
do
    service=`echo $amap | awk '{z=split($0,a,"/"); split(a[z],b,"."); print b[1]}'`
    res=""
    if  [ -f "whitelist.txt" ]; then
        res=`cat whitelist.txt | egrep "^$service$"`
    fi
    if  [ ! -z "$res" ]; then
        echo "Skip service $service"
        continue
    fi
    echo "Read API maps from $amap"
    $cmd --uri-map=$amap
    echo "Read notation map from $amap"
    $cmd --notation-map=$amap
    echo "Read presentation map from $amap"
    $cmd --presentation-map=$amap
done
