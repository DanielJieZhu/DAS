%\appendix
\begin{appendix}
\section{DAS Query logs (from 2011-06-21 to 2012-10-01)}

From the logs it can be seen that queries requiring heavy joins are quite common (100K queries through command line interface) that makes it worth investigating the possible performance optimizations.

\subsection{Common query patterns through Web browser}
total valid queries: 569,408
\\
not well formed queries (e.g. free text, typing mistakes, spam): 98,923

\begin{Verbatim}[commandchars=\\\{\},numbers=left,numbersep=4pt]
50.16% (285605)	:	dataset dataset.name=?
13.54% (77071)	:	site dataset.name=?
8.96%  (51035)	:	file dataset.name=?
5.88%  (33504)	:	run dataset.name=?
2.59%  (14739)	:	release dataset.name=?
2.11%  (12036)	:	config dataset.name=?
\textcolor{red}{1.65%  (9420) 	:	dataset run.run_number=?}
1.34%  (7642) 	:	block dataset.name=?
1.24%  (7084) 	:	dataset site.name=?
1.15%  (6562) 	:	dataset dataset.name=? release.name=?
1.10%  (6287) 	:	parent dataset.name=?
0.96%  (5488) 	:	file file.name=?
0.92%  (5245) 	:	dataset dataset.name=? status.name=?
0.77%  (4363) 	:	dataset release.name=?
\textcolor{red}{0.75%  (4257) 	:	file dataset.name=? run.run_number=?}
0.68%  (3874) 	:	run run.run_number=?
0.53%  (2994) 	:	site site.name=?
0.45%  (2576) 	:	site file.name=?
0.45%  (2556) 	:	dataset file.name=?
0.43%  (2438) 	:	lumi file.name=?
\textcolor{red}{0.40%  (2282) 	:	dataset dataset.name=? site.name=?}
0.35%  (1999) 	:	file block.name=?
0.35%  (1970) 	:	dataset dataset.name=? run.run_number=?
0.29%  (1640) 	:	group dataset.name=?
0.29%  (1631) 	:	lumi run.run_number=?
\end{Verbatim}

\begin{verbatim}
Interesting non-valid queries:
* keyword search: *herwig*/AODSIM
* Users may like more complex combined queries:
    lumi file = (file dataset=/RelValProdTTbar/JobRobot-MC_42_V12_JobRobot-v1/GEN-SIM-RECO)
    file,lumi dataset=/RelValProdTTbar/JobRobot-MC_42_V12_JobRobot-v1/GEN-SIM-RECO
* Users mixing up the post and pre filters:
    file dataset=/MuEG/Run2011B-PromptReco-v1/AOD, file.size >1
    file dataset=/MinimumBias/Run2010A-valskim-v6/RAW-RECO* | grep run between  [138923, 144086] 
\end{verbatim}
\newpage
\subsection{Common query patterns through Command Line\label{appendix_das_cli_logs}}
total valid queries: 6,9M\\
non valid queries: 76K

\begin{Verbatim}[commandchars=\\\{\},numbers=left,numbersep=4pt]
39.56% (2735728):	dataset dataset.name=?
22.80% (1576886):	dataset dataset.name=? status.name=?
12.49% (863636) :	file dataset.name=?
12.44% (860626) :	run run.run_number=?
4.60%  (318248) :	site dataset.name=?
2.18%  (150845) :	run dataset.name=?
\textcolor{red}{1.71%  (118404) :	file dataset.name=? run.run_number=?}\label{run_dataset_heavy}
1.32%  (90988)  :	file block.name=?
1.26%  (87266)  :	file file.name=?
0.50%  (34482)  :	block site.name=?
0.35%  (24049)  :	lumi file.name=?
0.25%  (17282)  :	release dataset.name=?
0.18%  (12556)  :	parent file.name=?
0.09%  (6341)   :	file dataset.name=? lumi.number=? run.run_number=?
\textcolor{red}{0.06%  (4306)   :	file dataset.name=? site.name=?}\label{site_dataset_distr_heavy}
0.05%  (3547)   :	dataset dataset.name=? primary_dataset.name=? release.name=? tier.name=?
0.05%  (3352)   :	dataset file.name=?
0.01%  (996)    :	parent dataset.name=?
0.01%  (755)    :	dataset site.name=?
\end{Verbatim}


% 
% Possible keyword search test cases:
% run duration run_number between [195100,195200] 
%
% py dataset=/DYJetsToLL_M-50_TuneZ2Star_8TeV-madgraph-tarball/Summer12_DR53X-PU_S10_START53_V7A-v1/AODSIM
%dataset dataset=*Run2011* datatype=data dataset=*RAW*

\end{appendix}
\begin{appendix}
%\appendix
\section{Data providers statistics}
\begin{verbatim}
(Some of the largest ones)

DBS:
    DB  size: 80GB + 200GB indexes, not many changes to existing  (old) records
    Largest tables: 
      Dataset (164K rows) -> Block (2M) -> Files (31M) -> FileRunLumi (902M) <- Runs (65K)

Phedex: ~7GB, more often changes to existing (even old) records
    change rate: 2,359,934 file transfers last month (from site A to site B; 
                 change rate on the DB to be found out)
\end{verbatim}
\end{appendix}
